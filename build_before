#! /usr/bin/env bash
set -ex
root=$(pwd)

if [ $cicd = "true" ]; then
    npm install -g webpack
    npm install -g webpack-cli
fi

cd vue_microfrontend
if [ $cicd = "true" ]; then
    yes | npm install
    yes | npm run install-all
fi
webpack --config ./webpack.config.js -p

cd ..
cp vue_microfrontend/build/microfrontend/microfrontend.js ./ui/microfrontend.js
cp index.html ./ui/index.html

cd $root