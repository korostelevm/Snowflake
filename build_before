#! /usr/bin/env bash
set -ex
root=$(pwd)
env
if [ $SUDO_USER = "runner" ]; then
    npm install -g webpack
    npm install -g webpack-cli
fi

cd vue_microfrontend
if [ $SUDO_USER = "runner" ]; then
    yes | npm install
fi
webpack --config ./webpack.config.js -p

cd ..
cp vue_microfrontend/build/microfrontend/microfrontend.js ./ui/microfrontend.js
cp index.html ./ui/index.html

cd $root

if [ $SUDO_USER = "runner" ]; then
    pip install --quiet aws-sam-cli 
    sam build
fi